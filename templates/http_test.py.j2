import requests
import pytest


def test_http_vulnerability():
    # 1️⃣ CONTEXTO
    ip = "{{ v.ip }}"
    vuln = "{{ v.vulnerabilities }}".lower()

    # 2️⃣ PROCESSAMENTO
    if "directory listing" in vuln:
        r = requests.get(f"http://{ip}", timeout=5)
        result = "Index of" in r.text

    elif "directory traversal" in vuln:
        r = requests.get(f"http://{ip}/../../../../etc/passwd", timeout=5)
        result = "root:" in r.text

    else:
        pytest.skip("Vulnerabilidade HTTP não suportada")
        return

    # 3️⃣ ASSERTIVA
    assert result is True
