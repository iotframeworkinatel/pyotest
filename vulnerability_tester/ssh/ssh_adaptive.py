"""
Adaptive SSH test variants â€” ONLY executed by the AutoML/adaptive strategy.
These tests check credential pairs and crypto features not covered by static tests.
Static COMMON_CREDENTIALS only has [('root', 'root'), ('admin', 'admin')].
"""
import paramiko


def test_ssh_weak_auth_extended(ip, port, timeout=3):
    """Try additional credential pairs beyond the static COMMON_CREDENTIALS."""
    extended_creds = [
        ("admin", "password"),
        ("admin", ""),
        ("user", "user"),
        ("test", "test"),
        ("root", "password"),
        ("root", "12345"),
        ("root", "toor"),
    ]
    for user, password in extended_creds:
        try:
            ssh = paramiko.SSHClient()
            ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
            ssh.connect(ip, port=port, username=user, password=password, timeout=timeout)
            ssh.close()
            return True
        except Exception:
            pass
    return False


def test_ssh_key_exchange_weak(ip, port, timeout=3):
    """Check for weak key exchange algorithms (diffie-hellman-group1-sha1, etc.)."""
    try:
        transport = paramiko.Transport((ip, port))
        transport.start_client(timeout=timeout)
        opts = transport.get_security_options()
        weak_kex = {
            "diffie-hellman-group1-sha1",
            "diffie-hellman-group-exchange-sha1",
        }
        for k in opts.kex:
            if k in weak_kex:
                transport.close()
                return True
        transport.close()
        return False
    except Exception:
        return False
