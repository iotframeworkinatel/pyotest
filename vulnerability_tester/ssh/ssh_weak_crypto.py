import paramiko


def test_ssh_weak_crypto(ip, port, timeout=3):
    try:
        transport = paramiko.Transport((ip, port))
        transport.start_client(timeout=timeout)

        opts = transport.get_security_options()
        weak = {"cbc", "md5", "sha1"}

        for c in opts.ciphers + opts.macs:
            if any(w in c.lower() for w in weak):
                transport.close()
                return True

        transport.close()
        return False
    except Exception:
        return False
