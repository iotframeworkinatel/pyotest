import socket

def test_rtsp_open(ip, port=554):
    try:
        sock = socket.create_connection((ip, port), timeout=2)
        request = f"OPTIONS rtsp://{ip}:{port}/ RTSP/1.0\r\nCSeq: 1\r\n\r\n"
        sock.send(request.encode())
        response = sock.recv(1024).decode()
        sock.close()
        return "RTSP/1.0 200 OK" in response
    except Exception as e:
        print(f"[!] RTSP test failed on {ip}:{port} -> {e}")
        return False



COMMON_RTSP_PATHS = ["/live.sdp", "/stream1", "/video", "/h264", "/mpeg4", "/"]

def test_rtsp_path_brute(ip, port=554):
    for path in COMMON_RTSP_PATHS:
        try:
            sock = socket.create_connection((ip, port), timeout=2)
            request = f"DESCRIBE rtsp://{ip}:{port}{path} RTSP/1.0\r\nCSeq: 2\r\n\r\n"
            sock.send(request.encode())
            response = sock.recv(1024).decode()
            sock.close()
            if "200 OK" in response or "RTSP/1.0 200" in response:
                return True, path
        except:
            pass
    return False, None