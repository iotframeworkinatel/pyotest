import paramiko
import logging
from utils.default_data import COMMON_CREDENTIALS

def test_ssh_weak_auth(ip_address, port=22, timeout=0.1):
    for user, password in COMMON_CREDENTIALS:
        ssh_client = paramiko.SSHClient()
        ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
        print(f"Attempting SSH login to {ip_address}:{port} with {user}/{password}")
        try:
            ssh_client.connect(
                hostname=ip_address,
                port=port,
                username=user,
                password=password,
                timeout=timeout
            )
            logging.warning(f"Successful SSH login to {ip_address} with {user}/{password}")
            ssh_client.close()
            return True

        except Exception as e:
            print(f"Unexpected error during SSH attempt to {ip_address} with {user}/{password}: {e}")
            if ssh_client:
                ssh_client.close()
    return False