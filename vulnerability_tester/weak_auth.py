import paramiko
import logging
import socket

COMMON_CREDENTIALS = [
    ('root', 'root'),
    ('root', 'admin'),
    ('root', 'password'),
    ('root', '12345'),
    ('admin', 'admin'),
    ('admin', 'password'),
    ('admin', ''),
    ('user', 'user'),
    ('test', 'test'),
]

def test_ssh_weak_auth(ip_address, port=22, timeout=5):
    for user, password in COMMON_CREDENTIALS:
        ssh_client = paramiko.SSHClient()
        ssh_client.set_missing_host_key_policy(paramiko.AutoAddPolicy())

        try:
            logging.debug(f"Attempting SSH login to {ip_address}:{port} with {user}/{password}")
            ssh_client.connect(
                hostname=ip_address,
                port=port,
                username=user,
                password=password,
                timeout=timeout,
                allow_agent=False,
                look_for_keys=False
            )
            logging.warning(f"Successful SSH login to {ip_address} with {user}/{password}")
            report = {'ip': ip_address, 'user': user, 'password': password}
            ssh_client.close()
            return report

        except paramiko.AuthenticationException:
            logging.debug(f"Authentication failed for {user}/{password} on {ip_address}")
        except (paramiko.SSHException, socket.error) as e:
            logging.error(f"SSH connection error to {ip_address} with {user}/{password}: {e}")
            ssh_client.close()
            return None
        except Exception as e:
            logging.error(f"Unexpected error during SSH attempt to {ip_address} with {user}/{password}: {e}")
        finally:
            if ssh_client:
                ssh_client.close()

    logging.info(f"No weak SSH credentials found for {ip_address}")
    return None